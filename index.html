<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DepCom | Streaming & Media</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILOS VISUALES (TU DISEÑO) --- */
        :root { --primary: #2962ff; --primary-dark: #0039cb; --bg-dark: #050505; --card-bg: rgba(20, 20, 20, 0.7); --glass: rgba(255, 255, 255, 0.05); --border: rgba(255, 255, 255, 0.1); --text-main: #ffffff; --text-sec: #b0b0b0; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: 'Montserrat', sans-serif; overflow-x: hidden; padding-bottom: 90px; }
        .background-fx { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at 50% 100%, #0d47a1, #002171 40%, #000000 90%); animation: breathe 8s ease-in-out infinite alternate; }
        @keyframes breathe { 0% { opacity: 0.7; } 100% { opacity: 1; } }
        
        /* HEADER */
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; backdrop-filter: blur(15px); background: rgba(0,0,0,0.6); border-bottom: 1px solid var(--border); }
        .logo { font-weight: 800; font-size: 1.5rem; color: #fff; letter-spacing: 1px; }
        .logo span { color: var(--primary); text-shadow: 0 0 10px var(--primary); }

        /* HERO */
        .hero { padding: 25px 20px 10px; }
        .hero h1 { font-size: 2rem; line-height: 1.1; margin-bottom: 20px; }
        .hero span { color: var(--primary); text-shadow: 0 0 15px rgba(41, 98, 255, 0.6); }
        .search-box { background: var(--glass); border-radius: 30px; padding: 12px 20px; display: flex; align-items: center; border: 1px solid var(--border); margin-bottom: 20px; transition: 0.3s; }
        .search-box input { background: transparent; border: none; color: white; width: 100%; margin-left: 10px; outline: none; font-family: inherit; font-size: 1rem; }

        /* GRID */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 0 20px; perspective: 1000px; min-height: 300px; }
        .loading-text { color: var(--text-sec); text-align: center; grid-column: 1 / -1; margin-top: 50px; }

        /* CARD */
        .card { background: var(--card-bg); border-radius: 16px; overflow: hidden; position: relative; height: 320px; border: 1px solid var(--border); transition: transform 0.1s ease-out, box-shadow 0.3s; cursor: pointer; transform-style: preserve-3d; display: flex; flex-direction: column; justify-content: flex-end; }
        .card:hover { box-shadow: 0 15px 30px rgba(0,0,0,0.5); border-color: var(--primary); z-index: 10; }
        .card-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: 0.5s; opacity: 0.8; z-index: -1; filter: grayscale(20%); }
        .card:hover .card-img { transform: scale(1.1); opacity: 0.5; filter: grayscale(0%); }
        .card-content { padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); transform: translateZ(20px); }
        .card-cat { color: var(--primary); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .card-title { font-size: 1.2rem; font-weight: 700; margin: 5px 0; line-height: 1.2; }
        .card-desc { font-size: 0.8rem; color: var(--text-sec); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .play-btn-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) translateZ(40px) scale(0.8); background: rgba(41, 98, 255, 0.9); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; box-shadow: 0 0 20px var(--primary); }
        .card:hover .play-btn-overlay { opacity: 1; transform: translate(-50%, -50%) translateZ(40px) scale(1); }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: red; color: white; padding: 5px; border-radius: 50%; cursor: pointer; z-index: 50; display: none; } 
        body.is-admin .delete-btn { display: block; }

        /* FOOTER */
        .footer-social { text-align: center; padding: 20px; margin-bottom: 20px; border-top: 1px solid var(--border); background: #020202; }
        .social-icons { display: flex; justify-content: center; gap: 25px; margin-top: 15px; }
        .social-link { color: #fff; transition: 0.3s; }
        .floating-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(20px); padding: 12px 30px; border-radius: 40px; display: flex; gap: 35px; border: 1px solid var(--border); box-shadow: 0 10px 40px rgba(0,0,0,0.9); z-index: 90; }
        .nav-item { color: #555; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--primary); text-shadow: 0 0 15px var(--primary); }

        /* PLAYER MODAL */
        .player-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 300; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.4s ease-in-out; }
        .player-modal.active { transform: translateY(0); }
        .video-container { flex: 1; background: #000; position: relative; display: flex; align-items: center; justify-content: center; }
        .video-container iframe { width: 100%; height: 100%; border: none; }
        .player-info { padding: 25px; background: #080808; border-top: 1px solid var(--primary-dark); }
        .controls-top { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; z-index: 10; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); }

        /* ADMIN PANEL REAL */
        .admin-trigger { position: fixed; bottom: 30px; right: 20px; z-index: 100; opacity: 0.5; cursor: pointer; transition: 0.3s; background: var(--bg-dark); border-radius: 50%; padding: 10px; border: 1px solid var(--border); }
        .admin-trigger:hover { opacity: 1; border-color: var(--primary); }
        
        .admin-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 400px; background: #111; border: 1px solid var(--primary);
            padding: 30px; border-radius: 15px; z-index: 400; box-shadow: 0 0 50px rgba(0,0,0,0.9);
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .admin-panel.active { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }
        .admin-panel h3 { margin-bottom: 20px; color: var(--primary); text-align: center; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; color: #aaa; margin-bottom: 5px; }
        .admin-panel input { width: 100%; background: #222; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; outline: none; }
        .btn-main { width: 100%; padding: 12px; background: var(--primary); border: none; color: white; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-main:hover { background: var(--primary-dark); }
        .btn-sec { background: transparent; border: 1px solid #333; margin-top: 10px; color: #888; }
        .close-admin { position: absolute; top: 15px; right: 15px; cursor: pointer; color: #666; }
        
        /* ESTADOS DEL ADMIN */
        #loginForm, #uploadForm { display: none; }
    </style>
</head>
<body>

    <div class="background-fx"></div>

    <header>
        <div class="logo">DEP<span>COM</span></div>
        <i class="material-icons" style="color: #fff; cursor: pointer;">menu</i>
    </header>

    <div class="hero">
        <div class="search-box">
            <i class="material-icons" style="color: var(--primary);">search</i>
            <input type="text" id="searchInput" placeholder="Buscar contenido...">
        </div>
        <h1>Descubre tus <br><span>Historias</span></h1>
    </div>

    <!-- GRID DE VIDEOS DINÁMICO -->
    <div class="grid" id="contentGrid">
        <div class="loading-text">Cargando videos desde la nube...</div>
    </div>

    <footer class="footer-social">
        <div class="social-icons">
            <a href="#" class="social-link"><i class="material-icons">facebook</i></a>
            <a href="#" class="social-link"><i class="material-icons">smart_display</i></a>
        </div>
        <p style="color: #444; font-size: 0.7rem; margin-top: 20px;">© 2024 DepCom App.</p>
    </footer>

    <!-- BOTÓN ADMIN -->
    <div class="admin-trigger" id="adminTrigger">
        <i class="material-icons" style="font-size: 24px; color: #fff;">lock</i>
    </div>

    <!-- PANEL ADMIN (Login y Subida) -->
    <div class="admin-panel" id="adminPanel">
        <i class="material-icons close-admin" id="closeAdmin">close</i>
        
        <!-- Formulario Login -->
        <div id="loginForm">
            <h3>Acceso Admin</h3>
            <div class="input-group">
                <label>Correo Electrónico</label>
                <input type="email" id="emailInput" placeholder="admin@depcom.com">
            </div>
            <div class="input-group">
                <label>Contraseña</label>
                <input type="password" id="passInput" placeholder="******">
            </div>
            <button class="btn-main" id="btnLogin">ENTRAR</button>
            <p id="loginMsg" style="color: red; font-size: 0.8rem; text-align: center; margin-top: 10px;"></p>
        </div>

        <!-- Formulario Subir Video -->
        <div id="uploadForm">
            <h3>Nuevo Video</h3>
            <p style="color:#aaa; font-size:0.8rem; margin-bottom:15px; text-align:center;">Pega el enlace de YouTube, nosotros traemos la foto y el título.</p>
            <div class="input-group">
                <input type="text" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=...">
            </div>
            <button class="btn-main" id="btnSave">GUARDAR VIDEO</button>
            <button class="btn-main btn-sec" id="btnLogout">Cerrar Sesión</button>
            <p id="uploadMsg" style="color: var(--primary); font-size: 0.8rem; text-align: center; margin-top: 10px;"></p>
        </div>
    </div>

    <!-- REPRODUCTOR -->
    <div class="player-modal" id="playerModal">
        <div class="controls-top">
            <i class="material-icons" style="color:white; font-size:30px; cursor:pointer;" onclick="closePlayer()">keyboard_arrow_down</i>
            <span style="color:var(--primary); font-weight:bold;">Reproduciendo</span>
        </div>
        <div class="video-container" id="videoContainer"></div>
        <div class="player-info">
            <h2 id="modalTitle">Título</h2>
            <span id="modalCat" style="color:var(--primary); font-size:0.8rem; text-transform:uppercase;">YouTube</span>
            <p id="modalDesc" style="margin-top: 15px;">Descripción</p>
        </div>
    </div>

    <!-- LÓGICA FIREBASE -->
    <script type="module">
        // --------------------------------------------------------------
        // 1. CONFIGURACIÓN (PEGA AQUÍ TUS LLAVES DE FIREBASE)
        // --------------------------------------------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            // --- PEGA LO QUE COPIASTE DE FIREBASE AQUÍ DENTRO ---
            apiKey: "AIzaWy...",
            authDomain: "tu-proyecto.firebaseapp.com",
            projectId: "tu-proyecto",
            storageBucket: "tu-proyecto.appspot.com",
            messagingSenderId: "...",
            appId: "..."
            // ----------------------------------------------------
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Variables Globales
        let allVideos = [];
        const grid = document.getElementById('contentGrid');

        // --------------------------------------------------------------
        // 2. LECTURA DE VIDEOS (AUTOMÁTICA EN TIEMPO REAL)
        // --------------------------------------------------------------
        const q = query(collection(db, "videos"), orderBy("date", "desc"));
        
        onSnapshot(q, (snapshot) => {
            allVideos = [];
            grid.innerHTML = '';
            
            if(snapshot.empty) {
                grid.innerHTML = '<div class="loading-text">No hay videos. Inicia sesión para agregar.</div>';
                return;
            }

            snapshot.forEach((doc) => {
                allVideos.push({ id: doc.id, ...doc.data() });
            });
            renderCards(allVideos);
        }, (error) => {
            console.error("Error leyendo videos:", error);
            grid.innerHTML = '<div class="loading-text">Error de conexión. Verifica las llaves de Firebase.</div>';
        });

        function renderCards(videos) {
            grid.innerHTML = '';
            videos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'card';
                
                // Botón de borrar (solo visible si eres admin)
                const deleteBtn = document.createElement('i');
                deleteBtn.className = 'material-icons delete-btn';
                deleteBtn.innerText = 'delete';
                deleteBtn.onclick = (e) => { e.stopPropagation(); deleteVideo(video.id); };

                card.innerHTML = `
                    <img src="${video.img}" class="card-img" alt="${video.title}" loading="lazy">
                    <div class="play-btn-overlay"><i class="material-icons" style="color:white;">play_arrow</i></div>
                    <div class="card-content">
                        <div class="card-cat">VIDEO</div>
                        <div class="card-title">${video.title}</div>
                        <div class="card-desc">${video.desc}</div>
                    </div>
                `;
                
                card.appendChild(deleteBtn);
                card.onclick = () => openPlayer(video);
                
                // Efecto 3D
                card.addEventListener('mousemove', (e) => handleTilt(e, card));
                card.addEventListener('mouseleave', () => resetTilt(card));
                
                grid.appendChild(card);
            });
        }

        // --------------------------------------------------------------
        // 3. LÓGICA DE ADMINISTRADOR (LOGIN Y GUARDADO)
        // --------------------------------------------------------------
        
        // Manejo de UI del Admin
        const adminPanel = document.getElementById('adminPanel');
        const loginForm = document.getElementById('loginForm');
        const uploadForm = document.getElementById('uploadForm');
        
        document.getElementById('adminTrigger').onclick = () => adminPanel.classList.add('active');
        document.getElementById('closeAdmin').onclick = () => adminPanel.classList.remove('active');

        // Detectar si el usuario está logueado
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Si hay usuario, mostrar formulario de subida
                loginForm.style.display = 'none';
                uploadForm.style.display = 'block';
                document.body.classList.add('is-admin'); // Habilita botones de borrar
                document.getElementById('adminTrigger').querySelector('i').innerText = "lock_open";
                document.getElementById('adminTrigger').querySelector('i').style.color = "var(--primary)";
            } else {
                // Si no, mostrar login
                loginForm.style.display = 'block';
                uploadForm.style.display = 'none';
                document.body.classList.remove('is-admin');
                document.getElementById('adminTrigger').querySelector('i').innerText = "lock";
            }
        });

        // Iniciar Sesión
        document.getElementById('btnLogin').onclick = async () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            const msg = document.getElementById('loginMsg');
            
            try {
                msg.innerText = "Verificando...";
                await signInWithEmailAndPassword(auth, email, pass);
                msg.innerText = "";
            } catch (error) {
                console.error(error);
                msg.innerText = "Error: Usuario o contraseña incorrectos.";
            }
        };

        // Cerrar Sesión
        document.getElementById('btnLogout').onclick = () => signOut(auth);

        // GUARDAR VIDEO EN FIREBASE
        document.getElementById('btnSave').onclick = async () => {
            const url = document.getElementById('youtubeUrl').value;
            const btn = document.getElementById('btnSave');
            const msg = document.getElementById('uploadMsg');

            if(!url) return;

            // 1. Extraer ID
            let videoId = "";
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length == 11) videoId = match[2];
            else { msg.innerText = "Enlace no válido"; return; }

            btn.innerText = "Obteniendo datos...";
            btn.disabled = true;

            try {
                // 2. Traer datos de YouTube (Sin API Key, usando Noembed)
                const response = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`);
                const data = await response.json();

                // 3. Guardar en Firestore
                btn.innerText = "Guardando en nube...";
                
                await addDoc(collection(db, "videos"), {
                    youtubeId: videoId,
                    title: data.title || "Video Nuevo",
                    // Usar miniatura HQ de YouTube directa
                    img: `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`, 
                    desc: data.author_name ? `Video por ${data.author_name}` : "Sin descripción",
                    date: Date.now() // Para ordenar
                });

                msg.innerText = "¡Video guardado con éxito!";
                document.getElementById('youtubeUrl').value = "";
                setTimeout(() => { msg.innerText = ""; adminPanel.classList.remove('active'); }, 1500);

            } catch (error) {
                console.error(error);
                msg.innerText = "Error al guardar. Revisa la consola.";
            } finally {
                btn.innerText = "GUARDAR VIDEO";
                btn.disabled = false;
            }
        };

        // BORRAR VIDEO
        window.deleteVideo = async (id) => {
            if(confirm("¿Seguro que quieres borrar este video?")) {
                try {
                    await deleteDoc(doc(db, "videos", id));
                } catch (e) {
                    alert("Error al borrar: " + e.message);
                }
            }
        }

        // --------------------------------------------------------------
        // 4. FUNCIONES VISUALES (REPRODUCTOR, BUSCADOR)
        // --------------------------------------------------------------
        
        window.openPlayer = (video) => {
            document.getElementById('modalTitle').innerText = video.title;
            document.getElementById('modalDesc').innerText = video.desc;
            document.getElementById('videoContainer').innerHTML = 
                `<iframe src="https://www.youtube.com/embed/${video.youtubeId}?autoplay=1&modestbranding=1&rel=0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
            document.getElementById('playerModal').classList.add('active');
        }

        window.closePlayer = () => {
            document.getElementById('playerModal').classList.remove('active');
            document.getElementById('videoContainer').innerHTML = '';
        }

        document.getElementById('searchInput').onkeyup = (e) => {
            const query = e.target.value.toLowerCase();
            const filtered = allVideos.filter(v => v.title.toLowerCase().includes(query));
            renderCards(filtered);
        }

        function handleTilt(e, card) {
            if(window.innerWidth < 768) return;
            const r = card.getBoundingClientRect();
            const x = ((e.clientX - r.left) / r.width - 0.5) * 10;
            const y = ((e.clientY - r.top) / r.height - 0.5) * -10;
            card.style.transform = `perspective(1000px) rotateX(${y}deg) rotateY(${x}deg) scale(1.02)`;
        }
        function resetTilt(card) { card.style.transform = `perspective(1000px) rotate(0) scale(1)`; }

    </script>
</body>
</html>